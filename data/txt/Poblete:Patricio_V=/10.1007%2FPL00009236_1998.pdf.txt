Algorithmica (1998) 22: 490–515

Algorithmica

© 1998 Springer-Verlag New York Inc.

On the Analysis of Linear Probing Hashing1

P. Flajolet,2 P. Poblete,3 and A. Viola4

Dedicated to Don Knuth on the occasion of the 35th anniversary of

his ﬁrst analysis of an algorithm in

–1963.

Abstract.
This paper presents moment analyses and characterizations of limit distributions for the construction 
cost of hash tables under the linear probing strategy. Two models are considered, that of full tables
and that of sparse tables with a ﬁxed ﬁlling ratio strictly smaller than one. For full tables, the construction
cost has expectation O(n3/2), the standard deviation is of the same order, and a limit law of the Airy type
holds. (The Airy distribution is a semiclassical distribution that is deﬁned in terms of the usual Airy functions
or equivalently in terms of Bessel functions of indices − 1
√
, 2
3 .) For sparse tables, the construction cost has
n), and a limit law of the Gaussian type. Combinatorial relations
expectation O(n), standard deviation O(
with other problems leading to Airy phenomena (like graph connectivity, tree inversions, tree path length, or
area under excursions) are also brieﬂy discussed.

3

Key Words. Analysis of algorithms, Hashing, Linear probing, Parking problem, Airy functions.

Introduction. Linear probing hashing, deﬁned below, is certainly the simplest “in
place” hashing algorithm [14], [23], [38].

A table of length m, T [1 . . m] is set up, as well as a hash function h that maps
keys from some domain to the interval [1 . . m] of table addresses. A collection
of n elements with n ≤ m are entered sequentially into the table according to the
following rule: Each element x is placed at the ﬁrst unoccupied location starting from
h(x) in cyclic order, namely the ﬁrst of h(x), h(x) + 1, . . . , m, 1, 2, . . . , h(x) − 1.

For each element x that gets placed at some location y, the circular distance between
y and h(x) (that is, y − h(x) if h(x) ≤ y, and m + h(x) − y otherwise) is called its
displacement. Displacement is both a measure of the cost of inserting x and of the cost of
searching x in the table. Total displacement corresponding to a sequence of hashed values
is the sum of the individual displacements of elements. As it determines the construction
cost of the table, we use both terms interchangeably.

We analyze here the total displacement dm,n of a table of length m (the number of
table locations) and size n (the number of keys), under the assumption that all mn hash

1 The work of Philippe Flajolet was supported in part by the Long Term Research Project Alcom-IT (# 20244)
of the European Union. The work of Patricio Poblete was supported in part by FONDECYT(Chile) under
Grant 1960881. The work of Alfredo Viola was supported in part by proyecto BID-CONICYT 140/94 and
proyecto CONICYT fondo Clemente Estable 2078/96.
2 Algorithms Project, INRIA, Rocquencourt, 78150 Le Chesnay, France. Philippe.Flajolet@inria.fr.
3 Department of Computer Science, University of Chile, Casilla 2777, Santiago, Chile. ppoblete@dcc.uchile.cl.
4 Pedeciba Informatica, Casilla de Correo 16120, Distrito 6, Montevideo, Uruguay. viola@ﬁng.edu.uy.

Received October 5, 1997; revised January 15, 1998. Communicated by H. Prodinger and W. Szpankowski.

On the Analysis of Linear Probing Hashing

491

sequences are equally likely. The problem has an equivalent formulation in terms of the
discrete version of the classical parking problem, originally due to R´enyi, that is of interest
in various physical problems. (A Mathematical Reviews search with keyword “parking”
lists 58 references over the period 1956–1998, some of which point to connections
with adsorption, fracture of composite materials, dehydrochlorination, queueing systems,
packings, and so on.) The discrete parking problem is for instance described by Knuth [23,
p. 545] in the following entertaining terms:

A certain one-way street has m parking spaces in a row numbered 1 to m. A man
and his dozing wife drive by, and suddenly, she wakes up and orders him to park
immediately. He dutifully parks at the ﬁrst available space [. . .].

In this formulation, the total displacement of cars from their intended base has exactly
the same distribution as the construction cost of linear probing hashed tables as seen
by a “cycle lemma” originally due to Knuth and presented in [23]. Back to algorithmic
applications, the basic version of linear probing hashing, as described above, is based on a
ﬁrst-come-ﬁrst-serve (FCFS) policy; alternative priority rules exist (like last-come-ﬁrstserve 
or “Robin Hood”), but total displacement remains unchanged; thus, our analysis
also applies directly to such variants of the basic algorithm.

Linear probing hashing has been the object of intense study; see the table on results
and the bibliography on pp. 51–54 of [14]. The simplicity of the algorithm goes well with
efﬁciency, at least when tables are not ﬁlled too much. However, despite the simplicity
of the algorithm, some of the probabilistic phenomena involved are not quite easy to
capture. In addition, there is also a special value for these problems since the ﬁrst
analysis of algorithms ever performed by Knuth [20] in 1962–1963 was that of linear
probing hashing. As Knuth indicates in many of his writings, the problem has had a
strong inﬂuence on his scientiﬁc career.5
Sparse tables, by which we mean tables with a ﬁxed ﬁlling ratio α = n/m strictly less
than 1, tend to behave reasonably well. This has been known, in the average case at least,
√
since Knuth’s ﬁrst analysis. We establish here that the construction cost of a sparse table
n), and we provide very
has an average that is O(n), a standard deviation that is O(
precise estimates for these quantities. The expectation estimate agrees naturally with the
known fact that a random search or insertion in a sparse table has expected cost O(1). In
addition, we precisely characterize the distribution of construction costs and prove that
it is Gaussian in the asymptotic limit. Thus, for sparse tables, observed values of costs
are highly likely to be extremely close to what the average-case analysis predicts.
In contrast, full (m = n) or almost full (m = n−1) tables are much less well-behaved.
The construction cost is O(n3/2) on average, a fact also consistent with Knuth’s early
analyses demonstrating that each late insertion in a table that ﬁlls up tends to contribute
with a nonconstant cost. We provide here precise estimates for the standard deviation
which turns out to be of the same order as the mean, namely O(n3/2), an indication of the
fairly high dispersion of costs. In fact, the construction cost admits a limit distribution
that is of the “Airy type,” involving Airy functions, or equivalently Bessel functions of
orders that are multiples of one-third.

5 See the footnote on p. 529 of [23].

492

P. Flajolet, P. Poblete, and A. Viola

The analysis starts with almost full tables (Section 2) that are the basic combinatorial
objects. The combinatorial principle on which this paper rests is a binary tree decomposition 
of almost full tables. From this, a difference-differential equation is derived that
is the key to the analysis (Lemma 2). Moments, in either exact or asymptotic form, are
obtained by a “pumping” process akin to the analysis of other cumulative parameters
of combinatorial structures. For instance, similar methods have been used in the investigation 
of limit distributions for path length in trees [44], [45], the comparison cost of
quicksort [17], the area under random walks [29], [30], as well as in moment analysis of
other combinatorial structures [19].

Sparse tables (Section 3) are then treated as labeled products of (almost) full tables,
so that the corresponding generating functions involve large powers. For moments, especially 
for the mean and variance, the analysis results rather directly from that of full
tables. However, for the limiting distribution, a somewhat delicate perturbative analysis 
of saddle point integrals is needed in order to derive a Gaussian law by means of
characteristic function estimates.

Globally, these results reinforce our conﬁdence that linear probing represents an
excellent tradeoff between algorithmic simplicity and efﬁciency, as long as the ﬁlling
ratio is not too large, say less than 2/3 or 3/4. These conclusions also apply to linear
probing sort [13], [14, pp. 168–170], whose analysis is almost isomorphic to that of
linear probing hashing.

From the methodological standpoint, linear probing connects to a wealth of interesting
combinatorial and analytic problems. A primary rˆole is played by the tree function ﬁrst
studied by Eisenstein and by the Ramanujan–Knuth Q-function whose major properties
we brieﬂy recall in Section 1. Regarding limit laws, the Airy distribution that surfaces
in the case of full tables is also present in random trees (inversions and path length),
in random graphs (the complexity or excess parameter), and in random walks (area);
we discuss brieﬂy in Section 4 some of the “reasons” for this fact. The Gaussian law
of sparse tables is an instance of a general combinatorial scheme of some generality:
our methods actually demonstrate that it should be expected in most cases where one
deals with an additive parameter on a random assembly of a large number of random
components.

1. The Tree Function and the Q-Functions. The main character in this paper is
the tree function that is deﬁned implicitly by T (z) = zeT (z) and appears originally in
problems related with the counting of rooted labeled trees [8], [15], [32], [39], [47]. The
Lagrange inversion theorem provides a number of series expansion like

T (z)m = m

n≥1

(1)
where ak = a(a − 1)··· (a − k + 1). Most generating functions in this paper involve
rational fractions in T (z) with denominators that are powers of (1 − T )−1. Lagrange
inversion also provides

n≥m

n!

nmzn,

(2)

1

1 − T (z)

= 1 +

nn zn
n!

.

(cid:88)

T (z) =

nn−1
n!

zn,

(cid:88)

nn−m−1

∞(cid:88)

n=1

On the Analysis of Linear Probing Hashing

493

The asymptotic form of coefﬁcients of any rational function of T is also directly recovered 
by singularity analysis [7], [33]. Application of the method requires the singular
expansion of T (z), itself obtained from the implicit function theorem.
LEMMA 1. The function T (z) has a dominant singularity at z = 1/e, and its singular
expansion there is

T (z) = 1 − δ(z) + 1

δ(z)2 − 11

δ(z)3 + 43

δ(z)4 + O(δ(z)5),

3

72

540

(3)

where δ(z) = √

√
1 − ez.

2

THE Q-FUNCTIONS.
In close association with the tree function is what Knuth has popularized 
under the name of the “Ramanujan Q-function.” This function [1], [21]–[23],
[39] and its close relatives play a central rˆole in the analysis of many algorithms and
data structures—hashing with linear probing [20], [23], union-ﬁnd algorithms [27], interleaved 
memory [26], optimal caching [24], and random mappings [2], [6], [22], most
notably. The Q-function is deﬁned by

or, in a way that is equivalent thanks to (1),
=

1

log

(4)

Q(n) = 1 + n − 1

n

+ ··· ,

n2

+ (n − 1)(n − 2)
(cid:88)
Q(n)nn−1 zn
n!
(cid:114)

n≥0

.

1 − T (z)
(cid:114)

Singularity analysis of the generating function yields immediately
+ ··· .

Q(n) ∼

(5)

πn
2

− 1
3

+ 1
12

π
2n

− 4
135n

An asymptotic series for Q(n) was ﬁrst derived by Ramanujan [1], and tight estimates
are obtained in [4].

For the purpose of expressing the average-case analysis of sparse tables, Knuth has

(cid:88)

i≥0

ni
mi

,

extended the Ramanujan Q-function as

Q0(m, n) =

so that Q(n) = Q0(n, n − 1). From the deﬁnition, one has
= emt
1 − t

Q0(m, n)mn t n
n!

(6)

.

∞(cid:88)

n=0

Basic asymptotic approximations entail

(7)

−

Q0(m, αm − 1) = 1
1 − α
+ α3 + 22α2 + 58α + 24

(1 − α)3 m
(1 − α)9

1

−1 + 2 + α

−2 − α2 + 8α + 6
(1 − α)7 m
−5).

−3

(1 − α)5 m
−4 + O(m

m

See [35] for a general framework.

494

P. Flajolet, P. Poblete, and A. Viola

2. Full Tables. Throughout this paper we consider tables that have m locations (m is
called the “length” of the table) and we let n denote the number of keys (the “size”).
Clearly, the number of tables (the number of hash sequences) with length m and size
n is mn, and such a table has m − n empty locations. By circular symmetry [23], for
nonfull tables such that m > n, we may freely assume that one of the empty locations
is the rightmost one. This assumption of a last empty location in nonfull tables is made
from now onwards. When n = m − 1, we say that such a table is almost full. Since
there are m − n empty locations, then the probability of the rightmost cell being empty
is (m − n)/m, and therefore there are mn−1(m − n) ways of creating such tables. In
particular, the number of almost full tables is mm−2 = (n + 1)n−1.
Inserting the last element into an almost full table yields a completely full table
corresponding to m = n. Since this last element may hash to any of the m locations of
the table, there are mm−1 = nn−1 ways of creating a full table in this way. In summary,
by convention, almost full and completely full tables do not “wrap around.” Clearly, the
distributions of total displacements dn,n−1 and dn,n are not affected by such a restriction.

NOTATIONS. The analysis is carried out by means of bivariate generating functions
and moments are then recovered via a family of operators deﬁned as follows. For any
function G(z, q),

(8)

UG(z, q) = G(z, 1),
ZG(z, q) = zG(z, q),
HG(z, q) = G(z, q) − qG(qz, q)

∂q G(z, q) = ∂G(z, q)
∂zG(z, q) = ∂G(z, q)

∂q

,

,

∂z



These operators act in the usual way on formal power series G(z, q) =(cid:80)

.

with each gn(q) a polynomial; in particular,

n gn(q)zn/n!,

HG(z, q) =

gn(q)(1 + q + q2 + ··· + qn)

zn
n!

.

1 − q
(cid:88)

n

Mike Paterson has designed an ingenious operator framework for the “local” analysis
of displacements; see the account of the “cookie monster” in [16]. The problem of
total displacement being fully history-dependent is, however, not clearly amenable to
Paterson’s techniques.

2.1. Combinatorial Analysis. We deﬁne Fn,k as the number of ways of creating an
almost full table with n elements and total displacement k. The corresponding bivariate
generating function is then

(cid:88)

n, k≥0

F (z, q) =

Fn,kqk zn
n!

,

and it starts like

F (z, q) = 1 + z
1!

+ (2 + q)

z2
2!

+ (6 + 6q + 3q2 + q3)

+ ··· .

z3
3!

On the Analysis of Linear Probing Hashing

495

Fig. 1. The binary tree decomposition of almost full tables.

Consider an almost full table of size n (and length n + 1). Immediately before the last
element is inserted, the table has two empty cells: one at some position k + 1, the other at
position n + 1 (see Figure 1). Then the element that is last to be inserted has an address
that is any number of the interval [1 . . k + 1], which corresponds to a displacement that
(cid:181)
assumes any value in [0 . . k]. The counting of possibilities gives rise to a recurrence on
the Fn(q) = n! [zn]F (z, q):

(cid:182)

Fk (q)(1 + q + ··· + qk )Fn−1−k (q).

Fn(q) = n−1(cid:88)

k=0

n − 1
k

This fundamental recurrence reﬂects a recursive binary decomposition of full tables. We
recognize here a product of exponential generating functions modiﬁed by the occurrence
of the H-operator deﬁned in (8).

LEMMA 2 (Basic Functional Equation).

∂
∂z

F (z, q) = F (z, q) · F (z, q) − q F (qz, q)

.

1 − q
(9)
In operator notation, this reads simply as ∂z F = F · HF.

placement equal to k, and let C(z, q) =(cid:80)

Let similarly Cn,k be the number of completely full tables of size n with total disn,
k Cn,kqk zn/n! be the corresponding bivariate
generating function. Since a completely full table of size n + 1 is created by inserting
the last element in an almost full table of size n, we have, from the deﬁnition of the
H-operator,

∂zC(z, q) = HF (z, q).

Note that the basic functional equation together with this last relation implies the additional 
relations
(10)
Not surprisingly, the analyses of total displacement in full and in almost full tables are
thus closely related.

or C(z, q) = log F (z, q).

F (z, q) = eC(z,q)

2.2. Moments. For total displacement in almost full tables, what we call the generating
function of rth factorial moments is, by deﬁnition,
q F (z, q) = ∂r

fr (z) := U ∂r

(11)

.

∂qr F (z, q)

q=1

(cid:175)(cid:175)(cid:175)(cid:175)

496

P. Flajolet, P. Poblete, and A. Viola

This name is justiﬁed by the fact that the rth factorial moment of total displacement is
given by

E[d (d − 1)··· (d − r + 1)] = [zn] fr (z)
[zn] f0(z)

,

where

d ≡ dn,n−1.

The basic functional equation (9) implicitly contains all the information about moments.
 We now develop properties of the family of operators introduced in (8) that are
designed to extract such moments explicitly.
First, we rederive the enumeration of full tables. What is needed is f0(z) := UF (z, q),

where F is determined by (9). Now, from the action of H on power series, one has

UH = ∂zZU or equivalently UHF (z, q) = ∂
∂z

(z F (z, 1)).

Thus, f0(z) satisﬁes the nonlinear differential equation obtained by applying U to (9):

(cid:48)(z) = Y (z)(zY (z))(cid:48).
This equation is equivalent to (log Y (z))(cid:48) = (zY (z))(cid:48)
words,

Y

, and so Y (z) = ezY (z). In other

f0(z) ≡ F (z, 1) = 1
z

T (z) = eT (z),

where T (z) is the classical tree function. Therefore, by (1), the number of almost full
tables is (n + 1)n−1. Similarly, by (10), UC(z, q) = log( f0(z)) = T (z) so that the
number of completely full tables is nn−1. These values are in accordance with what we
know already from direct combinatorial reasoning.

A similar device produces moments upon applying U ∂r

q to the fundamental equation 
(9). What is needed is a “commutation rule” for the linear operators U ∂r
q and H.
This is readily found for r = 1 since
U ∂qH(znqk ) = U ∂q ((1 + q + ··· + qn)znqk ) = ((1 + 2 + ··· + n) + (n + 1)k)zn.
Thus, symbolically

U ∂qH = 1

z Z + U ∂zZ ∂q ,

2 Z ∂ 2

and, by similar devices,

q H = ∂zZU ∂ 2

q

U ∂ 2

+ Z ∂ 2

z ZU ∂q + 1

3 Z2 ∂ 3

z ZU.

As a consequence, f1(z) and f2(z) satisfy the following linear ordinary differential

equations,

2 z f0(z f0)(cid:48)(cid:48),

LY = 1
LY = z f1(z f0)(cid:48)(cid:48) + 2 f1(z f1)(cid:48) + 1

(12)
(13)
where L is the differential operator
(14)

LY = Y
= Y

(cid:48) · (1 − z f0) − Y · ((z f0)(cid:48) + f0)
(cid:48) · (1 − T ) − Y · T (2 − T )
z(1 − T )

.

3 z2 f0(z f0)(cid:48)(cid:48)(cid:48) + z f0(z f1)(cid:48)(cid:48),

On the Analysis of Linear Probing Hashing

497

The corresponding homogeneous ordinary differential equation,

admits the solution

LY = 0,

Y (z) = eT (z)
1 − T (z)

.

The variation-of-constant method then applies to the inhomogeneous differential equations 
(12) and (13) that are both of the form

and yields the solution

(15)

Y (z) = eT (z)
1 − T (z)

z

R(u)e

−T (u) du.

LY (z) = R(z),

(cid:90)

0

−T and dz = (1 − T )e

The quantities appearing in these differential equations can be expressed as functions of
T (z) alone since z = T e
−T dT . Thus the integrations needed in
the variation-of-constant method all eventually reduce to integration of elementary functions 
for which decision procedures exist. We then obtain mechanically the generating
functions of the ﬁrst two moments for an almost full table. (This is, for instance, well
within the capabilities of the computer algebra system Maple.)

LEMMA 3 (Almost Full Tables, Generating Functions for the Moments).

z f1(z) = 1
2
z f2(z) = 1
12

T 3(z)
(1 − T (z))2
T (z)4(24 − 11T (z) + 2T (z)2)

,

.

(1 − T (z))5

For a completely full table, the corresponding generating functions result from Lemma 3

and (10):

(16)

(17)

U ∂qC(z, q) = f1
= 1
2
f0
q C(z, q) = f2 f0 − f 2

U ∂ 2

T 2

(1 − T )2
= 1
12

1

f 2
0

,

T 3(24 − 14T + 5T 2)

(1 − T )5

.

Explicit expressions for the coefﬁcients of functions appearing in (16) and (17) are
then obtained from the expansions (2) and (4). Since T (z) satisﬁes the differential relation

the class of functions(cid:189)

(Z ∂z)r

(Z ∂z)T (z) = T (z)
1 − T (z)
(cid:190)∞
(cid:189)

,

,

r=0

(Z ∂z)r log

1
1 − T

(cid:190)∞

,

r=1

1
1 − T

498

P. Flajolet, P. Poblete, and A. Viola

spans a linear space that contains all the rational functions of the form A(T )/(1 − T )r ,
with A a polynomial of degree < r. As a consequence, for any such rational function of
T , there exists an expansion

(18)

[zn]

A(T (z))
(1 − T (z))r

= nn−1

n!

(U (n) + V (n) Q(n)) ,

for some polynomials U and V that can be mechanically determined.

THEOREM 1 (Full Tables, Exact Form of Moments).

E[dn,n] = n
2
n,n] = n
E[d2
12

(Q(n) − 1),
(5n2 + 4n − 1 − 8n Q(n)).

Thanks to (3), singularity analysis applies directly to the solutions (16) and (17).

(Alternatively, the explicit forms of Theorem 1 can be used in conjunction with (5).)

THEOREM 2 (Full Tables, Asymptotic Form of Moments).

√
2π
4

E[dn,n] =
Var[dn,n] = 10 − 3π

24

√
2π
48

n3/2 − 2

3 n +

n3 + 16 − 3π

144

135

n1/2 − 2
√
n2 +
2π
135

+ O(n
−1),
n3/2 − π + 48

576

n + O(n1/2).

2.3. Limit Law. Our goal in this subsection is to establish the existence of a limit
distribution for the construction cost of almost full tables. As this limit distribution turns
out not to be part of the set of classical continuous distributions, we ﬁrst specify it
precisely.

DEFINITION 1. The Airy distribution is the probability distribution of a random variable
X with support on [0,+∞) that is uniquely determined by its moments,

where the basic constants r are deﬁned by the formal series expansion

E[X r ] = −
(cid:88)

(− 1

)

2

((3r − 1)/2)

r ,

= − 2/3(w)
−1/3(w)

,

r

r≥0

with

ν (w) = 1 − (4ν2 − 1)

wr
r!

(cid:181)

(cid:182)

3w
8

3!

+ (4ν2 − 1)(4ν2 − 9)

(cid:182)2

(cid:181)
(cid:182)3 + ··· .

3w
8

(cid:181)

2!

3w
8

− (4ν2 − 1)(4ν2 − 9)(4ν2 − 25)

On the Analysis of Linear Probing Hashing

499

Under various guises, the Airy distribution arises as a limit distribution in quite diverse
contexts. Examples include the area under nonnegative random walks [29], [30] or path
length in random trees [44], [45]; this limit law also relates to asymptotic estimates of
connectivity in random graphs [49], [18]. At the end of this paper, we comment brieﬂy on
the combinatorics that underlies some of these connections. Our derivation here follows
in spirit the approach of Louchard and Tak´acs [29], [30], [44], [45], who also justiﬁed that
the Airy distribution as deﬁned here is indeed uniquely characterized by its moments.

We now examine in detail the process that yields the moments asymptotically and
show how the Airy distribution arises from a recurrent determination of moments. A
basic process similar to the one employed for the ﬁrst two moments yields a general
commutation rule for the H and ∂q operators

LEMMA 4.

(19)

(cid:181)

(cid:182)

q H = j(cid:88)

s=0

U ∂ j

j
s

1
s + 1

.

q

Zs ∂ s+1

z ZU ∂ j−s
(cid:33)
(cid:195)
n(cid:88)

Then the Leibniz rule applied to the differentiation of products qi qk yields

U ∂ j

PROOF. The left-hand side applied to znqk gives
q H(znqk ) = znU ∂ j
n(cid:88)
j(cid:88)
(cid:182)
(cid:181)
= j(cid:88)

(cid:182)
i s k j−s = zn

(cid:195)
n(cid:88)

= zn

znU ∂ j
q

(cid:33)

(cid:181)

qi qk

i=0

s=0

i=0

j
s

q

i=0

s=0
z ZU ∂ j−s

q

Zs ∂ s+1

qi qk

(cid:181)

j(cid:88)

j
s

1
s + 1

s=0

.

(cid:182)

(znqk ).

j
s

(n + 1)s+1 k j−s

1
s + 1

From there, a differential equation for the rth factorial moment generating function
fr is directly obtained by a combination of Leibniz’s rule and of the commutation
relation (19) applied to the fundamental equation (9):

∂z fr (z) = r(cid:88)

(cid:181)

j(cid:88)

(cid:182)(cid:181)

(cid:182)

j=0

s=0

(20)

r
j

j
s

1
s + 1

fr− j (z) · (Zs ∂ s+1

z Z fj−s (z)).

The differential equation (20) that gives access to the rth moment is of the form

where L is the linear differential operator of (14). There, Rr (z) is exactly the right-hand
(z), namely, the terms correspondside 
of (20) stripped of its terms that contain fr (z), f
ing to ( j, s) = (0, 0) and ( j, s) = (r, 0). By the variation-of-constant method, moments
can then be pumped ad libidinem, and we have from (15)

(cid:48)
r

(21)

fr (z) = eT (z)
1 − T (z)

z

Rr (u)e

−T (u) du.

LY (z) = Rr (z),

(cid:90)

0

500

P. Flajolet, P. Poblete, and A. Viola

For instance, we obtain automatically

z f1 = T 3
2
z f2 = T 4
12
z f3 = T 4
8

z f4 = T 5
240

1

,

(1 − T )5

(1 − T )2
24 − 11 T + 2 T 2
8 + 144 T − 110 T 2 + 63 T 3 − 17 T 4 + 2 T 5
10,800 + 64,560 T − 60,072 T 2 + 53,760 T 3

(1 − T )8

,

,

−26,865 T 4 + 9140 T 5 − 1750 T 6 + 152 T 7

.

(1 − T )11

The success of the pumping method is obvious as regards asymptotic forms at least
since conditions of singularity analysis are preserved under multiplication by rational
functions of T and under integration. (In fact, there always exist exact rational forms in T ,
as shown by a more sophisticated argument, but this is immaterial here.) An asymptotic
pattern clearly emerges:

z f1 ∼ 1
2
z f3 ∼ 45
4

1

,

(1 − T )2
(1 − T )8

1

,

,

1

(1 − T )5

z f2 ∼ 5
4
z f4 ∼ 3315
16
−1, that is to say T → 1. The following

(1 − T )11

1

,

where the approximations hold when z → e
lemma characterizes the dominant terms of fr (z) precisely.
LEMMA 5. The factorial moment generating functions satisfy, for r ≥ 1,

(22)

z fr (z) =
=

Cr

(1 + O(1 − T ))

Cr

(1 − T (z))3r−1
(2(1 − ez))3r/2−1/2
(cid:182)
(cid:181)
Cj Cr− j − δr,0 = 0,

(3r − 4)rCr−1 + r(cid:88)

(1 + O((1 − ez)1/2))

r
j

j=0

where the constants Cr are determined by the nonlinear recurrence

(z → e

−1),

C0 = −1.

(23)

PROOF. The property holds for r = 1, 2 by Lemma 3. For general r, the variation-ofconstant 
formula (21) entails (by induction) that the singular behavior fr is of the form
z fr ∼ Cr (1 − T )−3r+1 as z → e
−1, in accordance with (22). In other words, the ∂z
operator shifts a singular expansion by a factor of (1− T )−2 while the ∂q operator shifts
such an expansion by a factor of (1 − T )−3.
s = 0 and ( j, s) = (r, 1). As a consequence we have, as z → e
∂z fr (1 − z f0) − fr ∂z(z f0) = r
2

The dominant contribution from (20) thus arises from the terms corresponding to

(z fr−1) + r−1(cid:88)

fr− j ∂z(z fj ) + O((1 − T )−3r+1).

(cid:181)

(cid:182)

−1,

∂ 2
z

r
j

j=1

On the Analysis of Linear Probing Hashing

501

Integration and multiplication of both sides by 2z yields the asymptotic relation

2z fr (1 − z f0) = r z ∂z(z fr−1) + r−1(cid:88)

(cid:181)

(cid:182)

r
j

j=1

(z fr− j )(z fj ) + O((1 − T )−3r+3).

The coefﬁcients of the dominant terms involving (1 − T )−3r+2 can then be identiﬁed,
and this provides a recursive determination of the coefﬁcients Cr :

2Cr = (3r − 4)rCr−1 + r−1(cid:88)

(cid:181)

(cid:182)

r
j

j=1

Cj Cr− j ,

r ≥ 1.

There, by a natural convention, we take C0 = −1 since f0 = 1 − (1 − T ) and it
is singular components that count. This recurrence is equivalent to the one stated
in (23).

The constants Cr determine the dominant asymptotic form of the moments of the law
of total displacement. Clearly, factorial moments and power moments are asymptotically
equivalent, and, by singularity analysis, one has

(24)

≡ E[(dn,n−1)r ] =

µ(r )
n

(1 + O(n

−1/2)).

√
π

2

((3r − 1)/2)

Cr

(cid:181)

(cid:182)3r/2

n
2

In order to establish the Airy limit distribution property, it is then necessary to identify
the coefﬁcients in (24). We show that in fact Cr = r , with r the fundamental constants
of Deﬁnition 1.

From (23), the quantities γr := Cr /r! satisfy a nonlinear recurrence

so that the exponential generating function of the Cr , γ (z) := (cid:80)

j=0

γj γr− j − δr,0 = 0,

satisﬁes a nonlinear ﬁrst-order ODE of the Riccati type:

r≥0 Cr zr /r!, itself

3z2γ (cid:48)(z) − zγ (z) + γ (z)2 − 1 = 0.

In a way, this basic equation is a “reduced image” of the fundamental differencedifferential 
equation when only dominant singular parts are retained. Now, it is known that
Riccati equations are reducible to linear second-order ODEs: set γ (z) = 3z2g
(cid:48)(z)/g(z),
so that

(25)

9z4g

(cid:48)(cid:48)(z) + 15z3g

(cid:48)(z) − g(z) = 0.

From there, the connection with Bessel functions is easy to establish and a computer
algebra system like Maple provides valuable hints. Some care is however needed due to
the multivalued character of Bessel functions of nonintegral order, so that we provide
some detail.

(3r − 4)γr−1 + r(cid:88)

502

P. Flajolet, P. Poblete, and A. Viola

The “modiﬁed” Bessel functions are deﬁned by

Iν (z) =

Kν (z) =

(cid:179)

z
2

(cid:180)ν ∞(cid:88)

k=0

π

2 sin νπ

(z2/4)k

k! (ν + k + 1)
(I−ν (z) − Iν (z)) ,

and, for nonintegral ν, they form of basis of solutions to the Bessel equation

One can then simply match (25) with (26) and verify that the general solution to (25) is

(26)

+ z

dw
dz

z2 d2w
dz2
(cid:181)

g(z) = z

−1/3

λ1 K−1/3

− (z2 + ν2)w = 0.
(cid:181)
(cid:181)

(cid:182)

+ λ2 I−1/3

1
3z

1
3z

(cid:182)(cid:182)

.

A simple computation then shows that the general solution of the original Riccati equation
is

γ (cid:104)λ(cid:105)(z) = − I2/3(1/3z) − λK2/3(1/3z)
I−1/3(1/3z) + λK−1/3(1/3z)

(27)
For determinacy, we restrict (27) to the complex z-plane slit along (−∞, 0).

.

We note at this stage that Bessel functions of order a multiple of one-third are related
to the classical Airy functions that are deﬁned as solutions to the linear differential
equation w(cid:48)(cid:48) − zw = 0. In particular, one has

(cid:90) ∞
(cid:181)
(cid:182)1/2

0
z
3

cos( 1

(cid:182)
(cid:181)
3 t 3 + zt )dt
2z3/2

K1/3

.

3

Ai(z) = 1
π
= 1
π

This (and other connections) justify our choice of naming the distribution of Deﬁnition 1
the Airy distribution.
Obviously, the γ (cid:104)λ(cid:105)(z) as obtained in (27) are nonanalytic at zero. Then (27) is to be
taken in the sense that the divergent (formal) series γ (cid:104)λ(cid:105)(z) represents asymptotically
the right-hand side as z → 0
. However, asymptotic expansions of Bessel functions are
well known: with µ = 4ν2, we have, as the variable y tends to +∞,

+

1 − µ − 1

+ (µ − 1)(µ − 9)

(28)
Iν (y) ∼ ey√
8y
2π y
while each Kν (y) = O(e
−y) is exponentially small. Thus, the asymptotic expansions of
all the γ (cid:104)λ(cid:105)(z) in the scale {zm} coincide, and we may as well take γ (z) = γ (cid:104)0(cid:105)(z). In
other words, the Cr are generated as coefﬁcients in the asymptotic expansion,

− (µ − 1)(µ − 9)(µ − 25)

+ ···

2! (8y)2

3! (8y)3

,

(cid:182)

(cid:181)

(29)

− I2/3(1/3z)
I−1/3(1/3z)

∼

Cr

zr
r!

(z → 0

+).

∞(cid:88)

r=0

On the Analysis of Linear Probing Hashing
Table 1. The Airy constants r and their various normalizations: ωr = r /r!, ω(cid:63)

503
= 22r−1r /r!, µ(r ) =

)/ ((3r − 1)/2). (The µ(r ) are the moments of the Airy distribution.)

r

−r (− 1

2

r

r
ωr
ω(cid:63)
r

µ(r )

0
−1
−1
− 1
2
1

1

1
2
1
2
√
1
π

2

5
4
5
8
5
10
3

3

45
4
15
8
√
60
π

15
4

4

3315
16
1105
128
1105
884
63

5

25,425

4

1695
32

√
27,120
565
π
32

6

7

8

18,635,625

64

414,125

1024

828,250
662,600

9009

18,592,875

1

59,025

16

30,220,800
19,675
π

√

192

403,839,930,375

256

1,282,031,525

32,768

1,282,031,525

4,102,500,880

8,729,721

From (28) and (29), we thus obtain a purely algebraic and explicit speciﬁcation of
γ (z) as a quotient of two divergent hypergeometric series (of the 2 F0 type) that matches
exactly the deﬁnition of the Airy distribution, with Cr = r . This characterizes the
distribution of construction cost in almost full hash tables.

THEOREM 3 (Limit Law for Full Tables). For almost full tables, the distribution of the
random variable dn,n−1/(n/2)3/2 converges to the Airy distribution, in the sense that,
pointwise for each x,

(cid:189)

(cid:190)

Pr

dn,n−1
(n/2)3/2

≤ x

→ Pr{X ≤ x}

(n → ∞),

where X is Airy distributed in the sense of Deﬁnition 1. The same property holds for
completely full tables and the random variable dn,n/(n/2)3/2.

(The property for full tables results from the fact that dn,n has the same distribution as
dn,n−1 + Un, where Un is uniform over [0 . . n − 1].)

Initial values of the Airy constants are given in Table 1. The normalized constants
= 22r−1r /r! turn out to be integers for r ≥ 1. This interesting sequence starts like

ω(cid:63)
r

1, 5, 60, 1105, 27120, 828250, 30220800, 1282031525, 61999046400, 3366961243750,
202903221120000, 13437880555850250, 970217083619328000, 75849500508999712500,
6383483988812390400000, 575440151532675686278125, 55318762960656722780160000,

and we propose calling it the Wright–Louchard–Tak´acs sequence (see the remarks above
and our conclusion). It is however not to be found in Sloane and Plouffe’s Encyclopedia
of Integer Sequences [41]. The variance of the Airy distribution is

− π = 0.19174 06797 43540 . . .

10
3

and the appearance of this magic value in a variance expression may be taken as a good
indication of the possible occurrence of the Airy distribution.

3. Sparse Tables.
In this section we analyze sparse tables, where the ﬁlling ratio
deﬁned as α = n/m is ﬁxed and bounded away from one. The behavior of such tables
turns out to be much more tame than that of full tables discussed in the previous section.

504

P. Flajolet, P. Poblete, and A. Viola

3.1. Combinatorial Analysis. As seen at the beginning of Section 2, a simple circular
symmetry argument enables us to restrict attention to tables whose last location is empty.
Such a table then decomposes as a labeled product of m − n clusters (sometimes also
ﬁguratively called “islands”) that are, up to relabeling, almost full tables. Note that a
cluster may well have size 0, in which case it comprises only one unoccupied cell. For
instance, the table

3

9

4

7

5

2

8

1

6

is, up to relabeling, a sequence of six almost full tables of respective sizes 0, 4, 0, 2, 1, 2.
Deﬁne the generating function Hm,n(q) that counts the number of ways of creating
a nonfull table of length m and size n (the rightmost location is empty) with q marking
the total displacement. The construction cost (or total displacement) of partial tables is
inherited additively from component clusters. Therefore, the total displacement in partial
tables of parameter (m, n) has generating function

Hm,n(q) = n! [zn]F (z, q)m−n.

The number of tables of length m, size n, with the last location empty is then

Hm,n(1) = n! [zn] f0(z)m−n = n! [zm]T (z)m−n,

a quantity that, by virtue of (1), equals (m − n)mn−1, in agreement with the circular
symmetry argument. The probability generating function of the total displacement dm,n
is then

Hm,n(q)
Hm,n(1)

=

n!

(m − n)mn−1 [zn]F (z, q)m−n.

3.2. Moments. The generating functions for sparse tables admit power forms that lend
themselves nicely to differentiation. In this way, moment generating functions are obtained 
immediately from the corresponding computation for full tables.

The analysis still relies on the functions fr = U ∂q

r F introduced in (11). We have

U ∂q F (z, q)m−n = (m − n) f m−n−1
U ∂q

2 F (z, q)m−n = (m − n)(m − n − 1) f m−n−2

f1,

0

0

+ (m − n) f m−n−1

0

f 2
1

f2.

The values of z f0, z f1, z f2 are known from Section 2, and are expressible in terms of
T = T (z) alone; this gives for instance,

n!

(m − n)mn−1 [zn]U ∂q F (z, q)m−n = n!

mn−1 [zm]

T (z)m−n+2
(1 − T (z))2

.

1
2

What is required at this point in order to obtain explicit forms is a method for coefﬁcient

extraction,

(30)

[zm] T (z)m−n A(T (z))
(1 − T (z))r

,

On the Analysis of Linear Probing Hashing

505

where A is a polynomial of degree < r. For computational purposes, it is convenient to
introduce the change of variables in Cauchy coefﬁcient integrals that underlies Lagrange
inversion:

(31)

[zm]λ(T (z)) = 1
2i π
= 1
2i π
= [t m]emt (1 − t )λ(t ).

dz
λ(T (z))
zm+1
λ(T )(1 − T )e

−T

dT

(T e−T )m+1

(cid:90)
(cid:90)

(Small contours around zero are understood in this derivation, and this shortcut is of
course logically equivalent to Lagrange–B¨urmann inversion.)

Then the application of (32) to (30) yields

This is close to the form (6) of the generating function of Q0(m, n). Now, an argument
similar to the one used in (18) for full tables applies. The linear space spanned by

[zm]T m−n A(T )
(1 − T )r

A(t )

(1 − t )r−1

.

= [t n]emt
(cid:190)∞

∪ {emt}

r=0

(cid:189)(cid:181)

(cid:182)r emt

1 − t

t

d
dt

contains all the rational functions of the form emt A(t )/(1 − t )r−1. Thus, there exist
polynomials U and V such that
[zm]T m−n A(T )
(1 − T )r

(U (m, n) + V (m, n) Q0(m, n)).

The computation is again purely mechanical. It can be recast in terms of Q0(m, n−1)
since Q0(m, n) = 1 + (m/n)Q0(m, n − 1), and the forms so obtained are consistent
with those for full tables (Theorem 1).

= mn
n!

THEOREM 4 (Sparse Tables, Exact Form of Moments).
E[dm,n] = n
2
m,n] = n
E[d2
12

(Q0(m, n − 1) − 1),
((m − n)3 + (n + 3)(m − n)2 + (8n + 1)(m − n) + 5n2 + 4n − 1
− ((m − n)3 + 4(m − n)2 + (6n + 3)(m − n) + 8n)Q0(m, n − 1)).

The approximation formula (7) then produces the asymptotic form of the ﬁrst moment

and of the variance of an α-sparse table.

THEOREM 5 (Sparse Tables, Asymptotic Form of Moments).
−1),

α

E[dm,n] =
2(1 − α)3
Var[dm,n] = 6α − 6α2 + 4α3 − α4

2(1 − α)

n −

α

+ O(n
n − 6α3 + 24α2 + 6α
12(1 − α)6

12(1 − α)4

+ O(n

−1).

506

P. Flajolet, P. Poblete, and A. Viola

3.3. Limit Law.
In this subsection we estimate the distribution of total displacement
in sparse tables, when m, n tend to inﬁnity in such a way that the ﬁlling ratio α = n/m
remains constant. We thus ﬁx α throughout and assume 0 < α < 1. The mean µn and
the variance σ 2
n of the distribution are in this case both O(n) and their precise form has
been given by the last two theorems.

The limit law is approached here by characteristic functions rather than by moments
as was done in the case of full tables. Indeed, cancellations already present in the variance 
preclude a moment approach. On the other hand, the power form of the involved
generating functions suggests an appeal to the saddle point method applied to Cauchy
coefﬁcient integrals, this in order to estimate characteristic functions. Some care is however 
needed since F (z, q) is sharply nonanalytic at q = 1. The analysis proceeds by a
(delicate) perturbation of the (easy) saddle point estimates of the univariate problem of
counting sparse tables, namely [zn]F (z, 1)m−n.

THEOREM 6 (Limit Law for Sparse Tables). The limit law of total displacement dm,n in
tables with ﬁlling ratio α = n/m that satisﬁes α < 1 is asymptotically Gaussian, as
n → ∞,

(cid:190)

(cid:90)

(cid:189)

dm,n − µn

σn

Pr

≤ x

→ 1√
2π

x
−∞

−s2/2 ds,

e

where µn = E[dm,n] is the mean of the distribution and σn deﬁned by σ 2
is the standard deviation, as given by Theorems 4 and 5.

n

= Var[dm,n]

PROOF. By L´evy’s continuity theorem, it is sufﬁcient to consider the characteristic
function of the standardized distribution (centered around its mean and scaled by its
standard deviation), that is,

(t ) =

ϕ(cid:63)
n

1

[zn]F (z, 1)m−n

−it µn /σn [zn]F (z, eit /σn )m−n),

(e

and prove that it converges pointwise for any ﬁxed t to the characteristic function of a
standard normal variate,

(t ) → e

−t 2/2.

ϕ(cid:63)
n

(32)
Since σn = O(

√
n), we analyze instead the closely related quantity
√
= eit µn /

n)m−n

so that

√

hn(t ) := [zn]F (z, eit /

nϕ(cid:63)

(33)

hn(t )
hn(0)

(cid:181)

(cid:182)

.

σnt√
n

The analysis of large coefﬁcients in large powers of generating functions is known, in
the univariate case at least, to be amenable to the saddle point method; see [3], [8]–[10],
and [33]. We start by brieﬂy reviewing the case t = 0 that corresponds to a univariate
problem expressed by the “unperturbed” integral,

(cid:90)

(34)

[zn]F (z, 1) = 1
2i π

F (z, 1)m−n dz
zn+1

.

On the Analysis of Linear Probing Hashing

507

By a standard argument, such an integral (34) involving large powers is precisely of the
type amenable to saddle point analysis. Here, we have F (z, 1) = f0(z) = T (z)/z, and
the saddle point equation is

d
dz

((m − n) f0(z) − n log z) = 0,
−1 at ζ = αe

which has a unique positive root between 0 and e
additionally T (ζ ) = α and f0(ζ ) = eα.

−α. At that point, one has
The classical saddle point analysis is based on integration on the circle|z| = ζ together
with the fact that only a small sector of amplitude δ around ζ dictates the asymptotic
contribution of the integral in (34). One should take nδ2 → ∞ and nδ3 → 0, for
instance, δ = n
−0.4 is suitable, a choice that we ﬁx here. Then a local expansion reduces
asymptotically and up to normalization the integral to be evaluated to a complete integral
−w2/2.
of e
Now, the strategy for evaluating the integral in (33) consists in adopting the same
integration contour |z| = ζ as in the unperturbed case (34). The perturbation introduced
√
in (33) by q = eit /
n must then be quantiﬁed precisely. It turns out that concentration in
a sector of amplitude δ = n
−0.4 still holds as the maximum of the integrand’s modulus
−0.5). Local
on the contour only gets displaced by a much smaller amount, namely O(n
expansions near the real axis then provide the asymptotic form of hn(t ), from which the
Gaussian law eventually results.
First, we establish globally that the geometry of F (z, q) on |z| = ζ does not differ
much from that of F (z, 1) when q = ei θ and θ lies in a suitably restricted interval around
zero. The derivatives

fr (z) = ∂r

∂qr F (z, q)

(cid:175)(cid:175)(cid:175)(cid:175)

q=1

(cid:182)2r

exist as formal power series in z that are furthermore analytic in |z| < e
−1. Also, since
the total displacement parameter on an object of size n is always at most n2, we have

(cid:182)r

(cid:181)

q

∂
∂q

(cid:181)

(cid:175)(cid:175)(cid:175)(cid:175)

F (z, q)

(cid:191)

z

∂
∂z

q=1

F (z, 1),

where (cid:191) indicates here coefﬁcientwise dominance between power series with nonnegative 
coefﬁcients. It results that F (z, ei θ ) is in fact an inﬁnitely differentiable function
of θ for all ﬁxed z inside the disk |z| < e
−1. (Construct formal derivatives whose analytic 
existence is guaranteed by the domination property and then recover F (z, ei θ ) by
repeated integration.) In particular, Taylor’s formula with remainder, when applied to
F (z, ei θ ), with z treated as a parameter, yields

(35)

F (z, ei θ ) = f0(z) + i θ f1(z) − θ 2
2
∂ 3
∂u3 F (z, eiu) du.

( f2(z) + f1(z))

(θ − u)2

+ 1
3!

(cid:90) θ

0

The last term is O(θ 3) and this estimate holds uniformly with respect to z, for z in any
subdisk of |z| < e
−1, since, by coefﬁcient dominance again, the third partial derivative

508

P. Flajolet, P. Poblete, and A. Viola

is dominated coefﬁcientwise by (z(d/dz))6 f0(z). The uniform estimate (35) precisely
quantiﬁes the way F (z, ei θ ) approximates F (z, 1).
Next, along the circle |z| = ζ , the quantity |F (z, 1)| has a unique maximum on the
real axis at the saddle point z = ζ . Also, |F (ζ ei ϕ, 1)| is an upward concave function
of the argument ϕ in a ﬁxed neighborhood of ϕ = 0. By the uniform approximation
property (35) and the continuity that it implies, upward ϕ-concavity, that is expressed by
a sign condition on second derivatives, must persist for F (ζ ei ϕ, ei θ ) provided θ stays in
a sufﬁciently small neighborhood of zero. Also, for values of ϕ outside the guaranteed
concavity interval and again θ suitably small, the approximation relation (35) entails that
|F (ζ ei ϕ, ei θ )| < F (ζ, 1) − ε, for some ﬁxed ε > 0.
The preceding discussion thus provides a clear picture of |F (z, ei θ )| on the circle
|z| = ζ . When θ, now a parameter, is such that |θ| remains less than a small ﬁxed
nonzero threshold θ0, the quantity |F (ζ ei ϕ, ei θ )| is upward concave near ϕ = 0 (that
is, for z near the real axis) while its values at least remain boundedly smaller than the
absolute maximum f0(ζ ), outside the concavity interval.

n, which is needed for estimating hn(t ). The value of t is ﬁxed and n
√
is assumed to be large enough so that the local concavity and majorization properties hold.
n)| occurs at ϕ = ϕ0(n),
A local expansion shows that the maximum of |F (ζ ei ϕ, eit /
where

Now take θ = t /

√

t√

(1 + O(n

−1)),

n

c1 = f1(ζ )

ζ f

(ζ )

(cid:48)
0

.

ϕ0(n) = −c1
(cid:90) +δ

This is well within the range of the unperturbed saddle point integral which is given by
−0.4. Therefore, we can conclude in the usual
the boundary points ζ e
way that

±i δ, where δ = n

hn(t ) = 1
2π

F (ζ ei ϕ, eit /

−δ

√
n)m−ne

−ni ϕ dϕ(1 + O(n

−1/2)).

(The error term could in fact be made exponentially small.)

Now, the analysis can be performed in the small interval [−δ,+δ] by means of local
expansions of the integrand, themselves attainable from the main approximation (35).
−1/2) error terms, it sufﬁces to use the quadratic approxFor 
estimates up to relative O(n
imation part of (35), so that

f0(ζ ei ϕ)m−n A(ζ ei ϕ)m−ne

−ni ϕ dϕ(1 + O(n

−1/2)),

(cid:90) +δ

−δ

hn(t ) = 1
2π

where

A(z) = 1 + i

t√
n

f1(z)
f0(z)

− t 2
2

f2(z) + f1(z)

f0(z)

.

From this point on, the computations are routine but particularly tedious, so that
we only sketch them. It sufﬁces to expand (m − n) log A(ζ ei ϕ) with respect to ϕ up
to quadratic terms again, then set ϕ = w/
(cid:181)
n, and extend the integration bounds to
(−∞,+∞). The integral is thereby reduced asymptotically to a form
a0 − a2
1
2a2

exp(a0 + ia1w − a2w2/2) dw =

(cid:90) +∞

(cid:115)

2π
a2

(cid:182)

(36)

exp

−∞

√

,

On the Analysis of Linear Probing Hashing

509

(cid:181)

f0(ζ )

ζ

that is evaluated by completing the square. Once more the support of a computer algebra
system like Maple is especially welcome, and one ﬁnds (some details omitted)
+ O(n
(ζ ) f1(ζ ))n1/2 + O(1),
n + O(n1/2),

(cid:182)
n+ iβt f1(ζ )
f0(ζ )
− 1
n + itβζ
(cid:48)
1
f0(ζ )2
(ζ )2 − ζ f
(ζ ) f0(ζ ) − f0(ζ ) f
(cid:48)(cid:48)
0
f0(ζ )2

(cid:181)
a0 = β log
(cid:48)
a1 =
β f
(ζ )
0
f0(ζ )
(cid:48)
a2 = βζ
ζ f
0
2

(ζ ) − f
(cid:48)
0

n1/2− βt 2
2

f2(ζ )+ f1(ζ )

− f1(ζ )2
f0(ζ )2

−1/2),

( f0(ζ ) f

f0(ζ )

(37)

(ζ )

(cid:48)
0

(cid:182)

with β = α−1 − 1.

All reductions done (!), we obtain from (36) and (37) the asymptotic estimate

(38)

= exp

hn(t )
hn(0)

i µn

t σn√
n

− t 2σ 2
n
2n

(1 + O(n

−1/2)),

(cid:182)

(cid:181)

(cid:82)

where use is made of the asymptotic forms of µn and σn.

We observe in passing (see also the comments below) that the asymptotic form of
moments derives systematically from the basic saddle point method and that the expressions 
can all be obtained directly in terms of fr and their derivatives evaluated at ζ . For
instance,

(cid:82)
f0(z)m−n−1 f1(z)z

f0(z)m−nz−n−1 dz

−n−1 dz

∼ βn

f1(ζ )
f0(ζ )

,

µn = (m − n)

(39)

and so on.

The ﬁnal estimate (38) after renormalization according to (33) then yields the convergence 
of characteristic functions (32). This completes the proof of the Gaussian limit
law.

The saddle point method has been used in a technically different context by Pittel [34]
who showed that the size of the largest cluster (hence, also the maximum displacement)
in a sparse linear probing table only grows logarithmically, on average and in probability.
The process used in the proof of the last theorem is in fact very general and we

encapsulate it into a general statement.

COROLLARY 1. A Gaussian limit law holds for the coefﬁcients of any “large power,”

β > 0,
(β ﬁxed, n → ∞) provided the following conditions hold:

[zn]G(z, q)βn,

(C1) G(z, q) =(cid:80)

n gn(q)zn has nonnegative coefﬁcients and deg gn(q) = O(nκ ) for
(C2) There exists some r with 0 < r ≤ +∞, such that G(z, 1) is analytic in |z| < r,
(C3) limz→r− zG

some integer κ.
and G(0, 1) (cid:54)= 0, G

(z, 1)/G(z, 1) = +∞.

(0, 1) (cid:54)= 0.

(cid:48)
z

(cid:48)
z

510

P. Flajolet, P. Poblete, and A. Viola

(C4) There exists n1, n2, k1, k2 with k1 (cid:54)= k2 such that the coefﬁcients [zn1qk1]G(z, q)

and [zn2qk2]G(z, q) are nonzero.

PROOF.
(Sketch) Condition (C1) ensures analyticity of partial derivatives and smooth
perturbation; (C3) ensures existence of the basic saddle point; (C2) ensures unicity of
this saddle point; (C4) ensures a nonzero variance. It can be recognized that these are
the only conditions used in the proof of Theorem 6, when one deﬁnes abstractly the
(ζ )− f0(ζ ) = 0. The
functions fr by U ∂r
moments are then all expressible in terms of ζ and the fr ; for instance, the mean of the
distribution is asymptotic to βn f1(ζ )/ f0(ζ ), in accordance with (39).

q G and the saddle point ζ by the equation βζ f

(cid:48)
0

Given its mild analytic conditions, Corollary 1 applies to a diversity of situations where
large random assemblies of labeled or unlabeled combinatorial objects are involved. In
the case of linear probing hashing, it implies that the number of clusters of some ﬁxed
size p has a distribution that is asymptotically Gaussian with mean and variance that are
both O(n).

4. Conclusion. The analysis of sparse tables (Section 3) is a by-product of the treatment 
of full tables (Section 2) that do constitute the primary combinatorial objects, so
that we discuss them in more depth here. The Airy distribution and its companion moment 
formulæ turn out to be part of a ring of problems treated often independently by a
variety of methods and authors. A brief census of “Airy phenomena” in combinatorial
applications then reveals ﬁve main ranges of problems that we now list (see Figure 2).

(P1) Construction cost in linear probing hashing. This is the context of Section 2 and
the analysis applies verbatim to total displacement in parking sequences as well.
(P2) Number of inversions in trees. An inversion in a rooted labeled tree is a pair (i, j )
such that i is on the path from the root to j and i > j. Exact generating functions
have been ﬁrst found by Mallows and Riordan [31] in the case of “Cayley” trees
and other families of trees are considered in [11].
(Q) Connectivity in graphs. A major problem in graphical enumeration and random
graph theory [5], [18] is the determination of the number γ (n, n + k) of connected
graphs with n vertices and n + k edges. (The quantity γ (n, n − 1) is for instance
the number of labeled trees, Tn = nn−1, discussed in Section 1.) The basic problem
was ﬁrst solved by Wright in a famous series of papers [49]–[51]. Wright’s solution
involves a quadratic recurrent sequence that, after normalization, is the same as
that of Section 2, so that the Airy constants make an appearance.

(R1) Area of excursions. By an excursion is meant a random walk that is never negative,
and has initial and ﬁnal altitudes both equal to zero; area is deﬁned as the sum of
altitudes of all nodes. The simplest type is the Bernoulli excursion deﬁned by ±1
steps (also called gambler’s ruin sequence); Louchard [29], [30] established that
the area of the Bernoulli excursion is asymptotically Airy distributed. Louchards
results are also related to other contemporary works from the early 1980s dealing
with Brownian motion [37], [40] where Airy functions also crop up explicitly.

On the Analysis of Linear Probing Hashing

511

Fig. 2. Five problems resorting to the “Airy phenomenon”: (P1, P2, R1, R2) lead to the Airy distribution while
(Q) involves the Airy constants.

(R2) Path length in trees. The path length of a tree is the sum of the distances of all
nodes to the root of the tree. In a series of papers, Tak´acs [44], [46] has established
limit Airy distribution results for various families of trees including Cayley trees
and Catalan trees as special cases, while rederiving independently in [43] and [45]
some of the results of Louchard.

Regarding methods, our Theorem 3 establishes directly the Airy law for (P1) by a
recursive determination of moments. A similar process has been employed by Louchard
and Tak´acs for (R1) and (R2). The underlying combinatorial decompositions are however
quite different. For (P1), one may regard the Airy law—via the quadratic recurrence or
the Riccati equation—as a reﬂection of the basic binary tree-like decomposition of linear
probing tables, while other decompositions prevail for (R1) and (R2). Problem (P2), as far
as we know, has not been previously considered under the angle of asymptotics and limit
distributions, but it appears eventually to be an essential element in the combinatorial
picture (see below).

The enumeration of connected graphs (Q) has a different status, since combinatorial
enumerations rather than limit distributions are involved. Wright’s major result states
that

γ (n, n + k) ∼

√
π2(1−3k)/2σk
((3k/2) + 1)

nn+(3k−1)/2,

for a family of constants σk. A direct comparison between our basic recurrence of (23)
and [49] shows that

2(k + 1)!
where the r are the Airy constants of Section 2.

σk =

1

k+1,

Thus, three limit distribution problems, namely (P1, R1, R2), have been found previously 
to lead to Airy laws, while structural constants of the Airy type are seen to appear
in the graph connectivity problem (Q). This suggests a closer look at combinatorial
relations between these problems.

(P1–P2) The fundamental recurrence of Section 2 in relation to (P1) is indeed identical
to the recurrence of [31] that models (P2). Thus, the two problems must be
combinatorially isomorphic. This fact has been noted by Knuth [25], following
Kreweras [28]. Knuth also evokes in [25] the alternative of a direct and exact

512

P. Flajolet, P. Poblete, and A. Viola

combinatorial correspondence based on Exercise 6.4-31 of [23]. An immediate 
consequence of the present work in conjunction with the observations of
Kreweras and Knuth is then: the number of inversions in a random Cayley tree
is asymptotically Airy distributed.

(P2–Q) An exact correspondence between inversions in trees and connectivity in
graphs seems to have been ﬁrst detected around the turn of the 1980s by several
authors. Gessel and Wang [12] have an especially elegant formulation in terms
of depth-ﬁrst search, where this mode of graph traversal leads precisely to a
tree augmented by return edges that form inversions.

(Q–R1) This thread is due to Spencer [42] who noted that breadth-ﬁrst search of a
random connected graph has a “trace” that is a random excursion of the socalled 
Poisson type. (Depth-ﬁrst search in the style of [12] is an alternative for
this correspondence.) Under Spencer’s correspondence, area under the Poisson
excursion relates in exact terms to “excess” of the original graph.

(R1–R2) There are many known similarities between random walks and random trees.
One of the most classical combinatorial correspondences relates bijectively
Bernoulli excursions and general Catalan trees (see, e.g., [21] and [39]). Under
this correspondence, area of an excursion transforms into path length of the
associated tree.

These various relations6 in a way “explain” the common occurrence of the Airy distribution 
in (P1, P2, R1, R2) as well as the rˆole of the Airy constants in problem (Q).
They also point to an alternative and more combinatorial deduction of the Airy law that
would be based on the following steps: (i) the exact equivalence between linear probing
and inversions in trees by (P1–P2); (ii) the exact equivalence between tree inversions
and graph connectivity (P2–Q) by depth-ﬁrst search; (iii) the exact reduction to Poisson
walks (Q–R1) by Spencer’s principle; (iv) the reduction to Louchard’s derivation of
the Airy law through an appeal to universality of Brownian motion. Our derivation of
Section 2 offers instead a self-contained approach to the problem.

POSTSCRIPT. Apart from this conclusion section, the technical developments of our
paper are otherwise independent of the recent preprint of Knuth [25]. Knuth has been
kind enough to share numerous informations regarding [25], and this sheds additional
light on the structure of the generating functions that appear in Sections 2 and 3. A major
consequence of [25] is that the fundamental difference-differential equation admits a
closed form solution. This can be checked by direct comparison with [31] or [25].
(Alternatively, the combinatorial correspondences mentioned above could be used.) As
a result, the bivariate generating function F (z, q) happens to have an explicit expression:

(cid:33)

(40)

F (z, q) = (q − 1)

∂
∂z

log

1 +

qn(n−1)/2 zn(q − 1)−n

n!

(cid:195)

∞(cid:88)

n=1

6 Exchanges with Joel Spencer in 1995, while [42] was being developed, have been at the origin of our interest
in Airy phenomena. Private communications with Knuth have then greatly helped us to complete the picture
offered in this section. See [25] for an insightful perspective.

On the Analysis of Linear Probing Hashing

513

∞(cid:88)
∞(cid:88)

n=0

n=0

=

qn(n+1)/2(zn(q − 1)−n/n!)

qn(n−1)/2(zn(q − 1)−n/n!)

These forms are recognizable variants of the bivariate generating functions of graphs,

(cid:88)

n,t

F (z, q + 1) =

γ (n, n + t − 1)qt

zn−1
(n − 1)!

,

and Knuth’s analysis starts precisely from this relation.

Notice that (40) does not trivialize our moment computations, since it is already far
from clear, given (40), that the tree functions should be involved. The manipulation of
q-series expansions like (40) is in fact particularly delicate, as attested by the “Giant
component” paper [18] on which [25] relies.

The exact correspondence with graph connectivity is at any rate neatly exposed by
(40). Preliminary work by Flajolet and Salvy (1995) inspired by Prellberg [36] indicates
that distributions can in fact be extracted from such a q-series by a method of coalescent
saddle points [48] that provides uniform asymptotic expansions and is well known to
lead to Airy functions. Such an approach should allow us to characterize the “phase
transition” between sparse and full tables, thanks to uniform asymptotics. In addition,
it provides an analytical “reason” for the Airy phenomena observed here: a law of the
Airy type may be generally expected whenever a coalescence of two neighboring saddle
points (a so-called “monkey saddle”) occurs in a Cauchy coefﬁcient integral.

Acknowledgments. The authors are thankful to Don Knuth, to whom this paper is
dedicated, for his constant support and his openness in sharing his thoughts on the
subject.

References

[1] Berndt, B. C. Ramanujan’s Notebooks, Part II. Springer-Verlag, Berlin, 1989.
[2] Broder, A. Two counting problems solved via string encodings. In Combinatorial Algorithms on Words,
A. Apostolico and Z. Galil, Eds., vol. 12 of NATO Advance Science Institute Series. Series F: Computer
and System Sciences. Springer-Verlag, Berlin, 1985, pp. 229–240.

[3] De Bruijn, N. G. Asymptotic Methods in Analysis. Dover, New York, 1981. A reprint of the third

North-Holland edition, 1970 (ﬁrst edition, 1958).

[4] Flajolet, P., Grabner, P., Kirschenhofer, P., and Prodinger, H. On Ramanujan’s Q-function. Journal of

Computational and Applied Mathematics 58(1) (1995), 103–116.

[5] Flajolet, P., Knuth, D. E., and Pittel, B. The ﬁrst cycles in an evolving graph. Discrete Mathematics 75

(1989), 167–215.

[6] Flajolet, P., and Odlyzko, A. M. Random mapping statistics. In Advances in Cryptology, J.-J. Quisquater
and J. Vandewalle, Eds., vol. 434 of Lecture Notes in Computer Science, Springer-Verlag, Berlin, 1990,
pp. 329–354. Proceedings of Eurocrypt ’89, Houtalen, Belgium, April 1989.

[7] Flajolet, P., and Odlyzko, A. M. Singularity analysis of generating functions. SIAM Journal on Discrete

Mathematics 3(2) (1990), 216–240.

514

P. Flajolet, P. Poblete, and A. Viola

[8] Flajolet, P., and Sedgewick, R. Analytic Combinatorics. Book in preparation, 1998. (Individual chapters

are available as INRIA Research Reports 1888, 2026, 2376, 2956, 3162.)

[9] Gamkrelidze, R. V., Ed. Analysis I, Integral Representations and Asymptotic Methods, vol. 13 of Encyclopedia 
of Mathematical Sciences. Springer-Verlag, Berlin, 1989.

[10] Gardy, D. Some results on the asymptotic behaviour of coefﬁcients of large powers of functions. Discrete

Mathematics 139(1–3) (1995), 189–217.

[11] Gessel, I., Sagan, B. E., and Yeh, Y.-N. Enumeration of trees by inversions. Journal of Graph Theory

19(4) (1995), 435–459.

[12] Gessel, I., and Wang, D. L. Depth-ﬁrst search as a combinatorial correspondence. Journal of Combinatorial 
Theory, Series A 26(3) (1979), 308–313.

[13] Gonnet, G., and Munro, J. The analysis of linear probing sort by the use of a new mathematical transform.

Journal of Algorithms 5 (1984), 451–470.

[14] Gonnet, G. H., and Baeza-Yates, R. Handbook of Algorithms and Data Structures: in Pascal and C,

second edn. Addison-Wesley, Reading, MA, 1991.

[15] Goulden, I. P., and Jackson, D. M. Combinatorial Enumeration. Wiley, New York, 1983.
[16] Greene, D. H., and Knuth, D. E. Mathematics for the Analysis of Algorithms, second edn. Birkh¨auser,

Boston, 1982.

[17] Hennequin, P. Combinatorial analysis of quicksort algorithm. RAIRO Theoretical Informatics and

[18]

Applications 23(3) (1989), 317–333.
Janson, S., Knuth, D. E., Luczak, T., and Pittel, B. The birth of the giant component. Random Structures
and Algorithms 4(3) (1993), 233–358.

[19] Kirschenhofer, P., Prodinger, H., and Tichy, R. ¨Uber einige Funktionaldifferentialgleichingen aus des
Analyse von Algorithmen. In Zahlentheoretische Analysis II, E. Hlawka, Ed., no. 1262 in Lecture Notes
in Mathematics, Springer-Verlag, Berlin, 1987, pp. 111–123.

[20] Knuth, D. E. Notes on “open” addressing. Unpublished memorandum, 1963. (Memo dated July 22, 1963.
With annotation “My ﬁrst analysis of an algorithm, originally done during Summer 1962 in Madison.”
Also conjectures the asymptotics of the Q-function, with annotation “Proved May 24, 1965.”)

[21] Knuth, D. E. The Art of Computer Programming, vol. 1, Fundamental Algorithms. Addison-Wesley,

Reading, MA, 1968.

[22] Knuth, D. E. The Art of Computer Programming, vol. 2, Seminumerical Algorithms. Addison-Wesley,

Reading, MA, 1969.

[23] Knuth, D. E. The Art of Computer Programming, vol. 3, Sorting and Searching. Addison-Wesley,

Reading, MA, 1973.

[24] Knuth, D. E. Analysis of optimum caching. Journal of Algorithms 6 (1985), 181–199.
[25] Knuth, D. E. Linear probing and graphs. Algorithmica, this issue, pp. 561–568.
[26] Knuth, D. E., and Rao, G. S. Activity in an interleaved memory. IEEE Transactions on Computers 24

(1975), 943–944.

[27] Knuth, D. E., and Sch¨onhage, A. The expected linearity of a simple equivalence algorithm. Theoretical

Computer Science 6 (1978), 281–315.

[28] Kreweras, G. Une famille de polynˆomes ayant plusieurs propri´et´es ´enum´eratives. Periodica Mathematica 
Hungarica 11 (1980), 309–320.

[29] Louchard, G. The Brownian excursion: a numerical analysis. Computers and Mathematics with Applications 
10(6) (1984), 413–417.

[30] Louchard, G. Kac’s formula, L´evy’s local time and Brownian excursion. Journal of Applied Probability

21 (1984), 479–499.

[31] Mallows, C. L., and Riordan, J. The inversion enumerator for labeled trees. Bulletin of the American

Mathematical Society 74 (1968), 92–94.

[32] Moon, J. W. Counting labelled trees. In Canadian Mathematical Monographs, vol. 1. Canadian Mathematical 
Congress, Montreal, 1970.

[33] Odlyzko, A. M. Asymptotic enumeration methods.

In Handbook of Combinatorics, vol.

II,

M. G. R. Graham and L. Lov´asz, Eds. Elsevier, Amsterdam, 1995, pp. 1063–1229.

[34] Pittel, B. Linear probing: the probable largest search time grows logarithmically with the number of

records. Journal of Algorithms 8 (1987), 236–249.

[35] Poblete, P. Approximating functions by their Poisson transform. Information Processing Letters 23

(1986), 127–130.

On the Analysis of Linear Probing Hashing

515

[36] Prellberg, T. Uniform q-series asymptotics for staircase polygons. Journal of Physics A: Mathematics

and General 28 (1995), 1289–1304.

[37] Rice, S. O. The integral of the absolute value of the pinned Wiener process—calculation of its probability

density by numerical integration. Annals of Probability 10 (1982), 240–243.

[38] Sedgewick, R. Algorithms, second edn. Addison-Wesley, Reading, MA, 1988.
[39] Sedgewick, R., and Flajolet, P. An Introduction to the Analysis of Algorithms. Addison-Wesley, Reading,

MA, 1996.

[40] Shepp, L. A. On the integral of the absolute value of the pinned Wiener process. Annals of Probability

10 (1982), 234–239.

[41] Sloane, N. J. A., and Plouffe, S. The Encyclopedia of Integer Sequences. Academic Press, New York,

1995.

[42] Spencer, J. Enumerating graphs and Brownian motion. Communications on Pure and Applied Mathematics 
50 (1997), 293–296.

[43] Tak´acs, L. A Bernoulli excursion and its various applications. Advances in Applied Probability 23

(1991), 557–585.

[44] Tak´acs, L. Conditional limit theorems for branching processes. Journal of Applied Mathematics and

Stochastic Analysis 4(4) (1991), 263–292.

[45] Tak´acs, L. On a probability problem connected with railway trafﬁc. Journal of Applied Mathematics

and Stochastic Analysis 4(1) (1991), 1–27.

[46] Tak´acs, L. The asymptotic distribution of the total heights of random rooted trees. Acta Scientiﬁca

Mathematica (Szeged) 57 (1993), 613–625.

[47] Wilf, H. S. generatingfunctionology. Academic Press, New York, 1994.
[48] Wong, R. Asymptotic Approximations of Integrals. Academic Press, New York, 1989.
[49] Wright, E. M. The number of connected sparsely edged graphs. Journal of Graph Theory 1 (1977),

317–330.

[50] Wright, E. M. The number of connected sparsely edged graphs. II. Smooth graphs. Journal of Graph

Theory 2 (1978), 299–305.

[51] Wright, E. M. The number of connected sparsely edged graphs. III. Asymptotic results. Journal of

Graph Theory 4 (1980), 393–407.

